\section{Guidelines for Community Brokers}\label{sec:community_brokers}

\subsection{The Role of Community Brokers}

Community brokers will play a vital role in enabling time-domain science with LSST.
By receiving the LSST alert stream, adding value, and redistributing it to the scientific community, brokers facilitate full exploitation of the scientific value of the real-time LSST alerts.

We envision that community brokers, individually or jointly, may provide a variety of functions.  These may include, but are not limited to:

\begin{itemize}
	\item redistributing alert packets
	\item filtering alerts
	\item cross-correlating LSST alerts with other static catalogs or alert streams
	\item classifying events scientifically
	\item providing user interfaces to the data
	\item coordinating scientific activity among collaborators
	\item triggering followup observing
	\item for users with appropriate data rights, facilitating followup queries and/or user-generated processing within the LSST Data Access Center
	\item managing annotation \& citation as followup observations are made
	\item collecting classification and other information gathered by the scientific community
\end{itemize}

Some of these functions may be performed by ``Target and Observation Managers'' \citep[TOMs;][]{2018arXiv180609557S} that may either be integrated into community brokers directly or connect to annotated and/or filtered streams delivered by a broker.
For simplicity, we will here refer to any system that connects directly to the LSST alert stream as a broker.

\subsection{Requirements for Community Brokers}

Because of the large data volume of the alert stream (several TB per night), finite bandwidth from the LSST datacenter prevents sending a full copy of the alert stream to all interested parties.
Additionally, we anticipate that community brokers will require some level of support from the LSST operations team.
Accordingly, LSST will conduct an open proposal process in order to select brokers with sufficient technical capability to enable valuable and reliable scientific returns.

We believe the scientific community will be best served by a rich broker ecosystem offering diverse capabilities. 
Any institution worldwide may submit a Letter of Intent (\S \ref{sec:LOIs}), and if invited, a full proposal.
Demonstration of appropriate technical and personnel resources to support the proposed goals will be the minimum requirement to be considered.

Recognizing that different science goals may benefit from different technical approaches, and that proposing institutions may have a range of strengths and experience, the proposal solicitation will not place any explicit functional requirements on proposed brokers.  
Thus a proposed broker is not \textit{required} to consume the whole stream, to redistribute the full stream, or to make its products world-public, for example.
However, given the small and finite number of brokers to be selected (\S \ref{sec:numbrokers}) and the evaluation criteria (\S \ref{sec:evaluation}), proposals offering to do so will be more likely to be selected.
The selection committee will evaluate the proposals holistically, weighing the unique capabilities proposed in order to maximize the scientific output of LSST.

While we expect the evaluation process to favor proposals that receive the full alert stream, brokers may propose to receive only a filtered subset of events (or a subset of the alert packet contents).  
We anticipate that this facility would be provided by the same technology underlying the LSST alert filtering service, potentially with less restrictive requirements than are placed on user-provided filters. 

\subsection{The Broker Selection Panel}

Broker proposals will be evaluated by a panel designated by the LSST Science Advisory Committee.  Appropriate care will be taken to avoid conflicts of interest.
The panel will include ex officio representatives from the LSST Project Office, LSST Operations, and LSST Data Management to provide policy and technical guidance.

\subsection{Letters of Intent} \label{sec:LOIs}

The broker proposal process will have two stages:  
an initial open call for Letters of Intent (LOIs) from all interested parties, and a subsequent full proposal call solicited from invited LOI writers.
This two-stage process ensures those writing full proposals have a reasonable chance at selection and provides an opportunity for early feedback.
An invitation to submit a full proposal may also be valuable to proposers in obtaining relevant funding.
No financial support is available from the LSST Project.

LOIs will be evaluated using the same criteria as the full proposals (\S \ref{sec:resources}--\ref{sec:evaluation}), with recognition that the proposed brokers may be in the conceptual or early design stage at the time of the LOI.


\subsection{Required Technical Resources} \label{sec:resources}

The panel will evaluate whether the proposed broker system is technically feasible and appropriately supported for the proposed goals.  
At minimum, this requires:

\begin{itemize}
	\item Large inbound and outbound network bandwidth (the full alert stream is a few TB/night)
	\item Petabytes of disk capacity
	\item Databases capable of handling billions of sources
	\item Compute resources to handle sophisticated classification and filtering tasks in real time at scale
	\item Appropriate personnel and sufficient effort to develop the required software and to maintain and operate the service
	\item Institutional support to ensure the longevity and stability of the service and software.
	\item Discussion of funding sources to support broker development and operations.
\end{itemize}

\subsection{Evaluation of Community Broker Proposals} \label{sec:evaluation}

The broker selection panel will evaluate proposals with a primary goal of maximizing the scientific exploitation of LSST---recognizing that many of LSST's scientific returns are likely to be unanticipated.

The panel will evaluate broker proposals that demonstrate appropriate technical resources (\S \ref{sec:resources}) using the following evaluation criteria:

\subsubsection{Scientific Value}

The panel will consider whether a proposed broker has the potential to add scientific value that serves a large community, enables high-profile science, or provides unique capabilities.
In particular, the panel will evaluate the proposed contributions to LSST's four science pillars\footnote{These are: Probing Dark Matter and Dark Energy, Taking an Inventory of the Solar System, Exploring the Transient Optical Sky, and Mapping the Milky Way \citeds{LPM-17}.}.
The panel will prioritize proposals that require or take advantage of the unique aspects of the LSST alert stream, namely its real-time and world-public nature.

\subsubsection{Availability to the World Community}

Because community brokers are the means by which scientists without LSST data rights may access the public contents of the alert packets, the panel will prefer proposals that make their products and services world-public.

\subsubsection{Scientific Validity}

The panel will look for evidence that scientific products, such as photometric classifications, produced by a proposed broker are accurate.  
Brokers may demonstrate performance in production on precursor surveys or by data challenge.
The proposal call will provide archived alert streams from precursor surveys that may be used for testing and evaluation.

\subsubsection{Integration with the Time-Domain Ecosystem}

For science cases involving real-time followup, the panel will consider the extent to which proposed brokers facilitate integration with followup resources, other surveys and alert streams, other brokers and services, existing communities of observers, and archives.  	


\subsubsection{Community Adoption}

The panel will consider whether a proposed broker system has already demonstrated scientific value and community adoption on precursor streams.  
This evaluation will also assess the 
range of scientific, geographic, and institutional communities that have utilized the service as well as the publications it enabled.


\subsubsection{Complementarity}

To maximize scientific returns, the panel will aim to select an ensemble of complementary brokers.
Brokers that are more limited in scope or scientific goals may be selected if they provide capabilities not present in other selected brokers or are serving scientific communities that would otherwise be unable to use LSST alerts.

\subsubsection{Existing Agreements}

The panel will consider the applicability of any existing agreements, if relevant.

\subsection{Determining the Number of Community Brokers} \label{sec:numbrokers}

Early sizing estimates indicated that only four full streams could be provided from the LSST Data Facility due to network bandwidth limitations.  
Current capacity projections indicate a larger number may be possible (\S \ref{sec:alert_distribution}), but with some uncertainty.
The available capacity will depend on:

\begin{itemize}
	\item actual network capacity and usage patterns
	\item details of the alert format
	\item the achieved purity of the alert stream
\end{itemize}

The proposal solicitation will provide updated estimates based on pipeline performance on precursor surveys.
Final capacity determination will not be possible until commissioning data is available from ComCam, currently early in 2021.
The broker selection panel may elect to make guaranteed and provisional selections based on these estimates.

\subsection{Resources for Proposers}

To aid in broker development and testing, at the time of the full broker proposal solicitation LSST will make available pre-packaged alert streams for precursor and/or simulated datasets generated by the LSST Alert Production pipelines and distributed with the expected formats and protocols.

\subsection{Resources for Selected Brokers}

Selected brokers will be expected to sign a Memorandum of Understanding codifying agreement to respect LSST Data Rights policies (where relevant) and outlining expected interfaces, support, and Service-Level Agreements for both parties.
Selected community brokers will receive basic support from the LSST Operations Team to ensure that the alert stream is delivered with the expected form, content, reliability, and timing.
Additionally, status information will be available during operations to diagnose processing and data transport problems as they arise.

\subsection{Timeline}

The calendar-year timeline presented below is the current best estimate based on the LSST project schedule and is subject to revision.
{
	\renewcommand\labelenumi{\textbf{\theenumi}}
\begin{enumerate}
  \setcounter{enumi}{2017}
	\item \begin{itemize} % 2018
		\item \textit{Q4} Plans and Policies for LSST Alert Distribution document issued
	\end{itemize}
	\item \begin{itemize}% 2019
		\item \textit{Q1} Issue call for Letters of Intent (LOI)
		\item \textit{Q2} Letters of intent due 
		\item \textit{June} Broker development workshop (invited LOI writers)
		\item \textit{Q3} Document bulk transport format and interface
		\item \textit{Q3} Set up test alert stream with sample precursor data
		\item \textit{Q4} Invite full proposals for community brokers from selected LOIs
		\end{itemize}
	\item \begin{itemize} %2020
		\item \textit{Q2} Broker proposals due
		\item \textit{Q3} Provisional broker selections made
		\end{itemize}
\end{enumerate}
}

Subsequent steps depend on major commissioning milestones and will shift according to the evolving commissioning schedule.
Alerts are provided during commissioning to enable engineering tests of broker interfaces.

\begin{itemize}
	\item \textbf{Sustained observing with ComCam} \textit{currently Q4 2020}
		\begin{itemize}
			\item \textit{$+$3 months} Produce sample commissioning alerts with ComCam \textit{with substantial latency}
			\item \textit{$+$6 months} Finalize number of full streams and select community brokers for early operations
			\item \textit{$+$1 year} Integrate selected brokers with the LSST Alert System
		\end{itemize}
	\item \textbf{LSSTCam Commissioning Mini-Surveys} \textit{currently Q3 2021}
		\begin{itemize}
			\item \textit{$+$1 month} Produce sample commissioning alerts with LSSTCam \textit{with substantial latency}
		\end{itemize}
	\item \textbf{Full LSST operations} \textit{currently Q4 2022}
\end{itemize}

It is reasonable to expect periodic review of broker performance and usage during LSST Operations.
Broker selections could be revisited or new brokers added due to changes in LSST survey or pipeline performance, broker performance or usage, or community science priorities.
